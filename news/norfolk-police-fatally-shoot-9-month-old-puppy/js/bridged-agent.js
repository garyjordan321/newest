(()=>{"use strict";var e,t,n=function(){function e(){}return e.set=function(e,t){localStorage.setItem(e,t)},e.get=function(e){return localStorage.getItem(e)},e}(),o=function(){function e(){}return e.getRequest=function(e){return new Promise((function(t,n){fetch(e).then((function(e){return e.json()})).then((function(e){t(e)})).catch((function(){console.log("API request failed"),n("API request failed")}))}))},e}(),r=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function a(e){try{s(o.next(e))}catch(e){i(e)}}function c(e){try{s(o.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((o=o.apply(e,t||[])).next())}))},i=function(e,t){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,o&&(r=2&c[0]?o.return:c[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,c[1])).done)return r;switch(o=0,r&&(c=[2&c[0],r.value]),c[0]){case 0:case 1:r=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,o=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!r||c[1]>r[0]&&c[1]<r[3])){a.label=c[1];break}if(6===c[0]&&a.label<r[1]){a.label=r[1],r=c;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(c);break}r[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],o=0}finally{n=r=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}},a=function(){function e(){}return e.prototype.getAndInjectScript=function(){return r(this,void 0,void 0,(function(){var e,t,n,o,r,a,c;return i(this,(function(i){switch(i.label){case 0:return e="",t=!1,this.debugMode=this.getDebugModeFromURL(),this.debugMode&&console.log("Debug mode is enabled"),null==(o=this.getVersionFromURL())||""==o?[3,1]:(e=o,t=!0,[3,4]);case 1:return(r=this.fetchScriptVersionStorage())?(e=r,[3,4]):[3,2];case 2:return[4,this.fetchScriptVersionFromAPI()];case 3:a=i.sent(),t=a.success,n=a.bridgedAgentVersionDTO,e=n.version,t&&this.storeVersionInStorage(n),i.label=4;case 4:return this.debugMode&&console.log("extracted version: ",e),c=this.getScriptElement(e),[4,this.waitForThePageToLoadAndInjectScript(c)];case 5:return i.sent(),[2]}}))}))},e.prototype.waitForThePageToLoadAndInjectScript=function(e){return r(this,void 0,void 0,(function(){var t=this;return i(this,(function(n){return[2,new Promise((function(n,o){var r=["informationweek.com","staging.informationweek.com","lightreading.com","staging.lightreading.com","darkreading.com","staging.darkreading.com","licenseglobal.com","staging.licenseglobal.com","insideselfstorage.com","staging.insideselfstorage.com","supplysidesj.com","staging.supplysidesj.com","farmprogress.com","staging.farmprogress.com"],i=new URL(window.location.href).host.replace("www.","");t.debugMode&&console.log("Setting up the timer to inject the script");var a=setInterval((function(){"complete"===document.readyState?(t.debugMode&&console.log("Document is ready to inject the script"),document.body.appendChild(e),t.debugMode&&console.log("Script is injected with completed document ready state"),clearInterval(a),n()):(t.debugMode&&console.log("Document is not ready yet, waiting for the document to be ready"),"interactive"!==document.readyState||r.includes(i)||(t.debugMode&&console.log("Document is interactive, injecting the script and page is not in the wait list"),document.body.appendChild(e),t.debugMode&&console.log("Script is injected with interactive document ready state"),clearInterval(a),n()))}),300)}))]}))}))},e.prototype.getVersionFromURL=function(){return new URL(document.URL).searchParams.get("loaderjs-version")||void 0},e.prototype.getDebugModeFromURL=function(){var e=new URL(document.URL).searchParams.get("debugMode");return!(!e||"true"!=e)},e.prototype.storeVersionInStorage=function(e){n.set("bridged-agent-version",e.version),e.pageMetaDataConfigs||(e.pageMetaDataConfigs=[]),n.set("pageMetaDataConfigs",JSON.stringify(e.pageMetaDataConfigs)),n.set("bridged-agent-version-last-updated",(new Date).toISOString())},e.prototype.getScriptElement=function(e){var t;try{t=document.currentScript.getAttribute("environment"),this.debugMode&&console.log("environment is extracted: ",t)}catch(e){this.debugMode&&console.log("environment is not found in the current script");for(var n=document.getElementsByTagName("script"),o=void 0,r=0;r<n.length;r++)"https://loader.bridged.media/bridged-agent.js"==n.item(r).src&&(o=n.item(r));o?(o.getAttribute("environment"),console.log("environment is extracted from the script element: ",t)):(this.debugMode&&console.log("Critical error, script element is not found. setting environment to production"),t="production")}if(t){if("staging"!=t&&"production"!=t)throw new Error("invalid environment value: ".concat(t))}else t="production";var i=document.createElement("script");return i.src="https://loader.bridged.media/".concat(e,"/bridged-loader.js"),i.id="bridged-loader",i.type="text/javascript",i.setAttribute("environmentt",t),i.async=!0,this.debugMode&&console.log("Script element is ready to be injected: ",i),i},e.prototype.fetchScriptVersionStorage=function(){var e=n.get("bridged-agent-version"),t=n.get("bridged-agent-version-last-updated");if(e&&t){var o=new Date(t);return(new Date).getTime()-o.getTime()<36e5?e:void 0}},e.prototype.fetchScriptVersionFromAPI=function(){return r(this,void 0,void 0,(function(){var e;return i(this,(function(t){switch(t.label){case 0:e="https://gateway.bridged.media/Configurations/BridgedAgentVersion?hostname=".concat(document.URL),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,o.getRequest(e)];case 2:return[2,{success:!0,bridgedAgentVersionDTO:t.sent().data}];case 3:return t.sent(),[2,{success:!1,bridgedAgentVersionDTO:{createdDate:new Date((new Date).getTime()-36e5),version:"v1.38.6",pageMetaDataConfigs:[]}}];case 4:return[2]}}))}))},e}();t=function(){return function(e,t){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,o&&(r=2&c[0]?o.return:c[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,c[1])).done)return r;switch(o=0,r&&(c=[2&c[0],r.value]),c[0]){case 0:case 1:r=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,o=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!r||c[1]>r[0]&&c[1]<r[3])){a.label=c[1];break}if(6===c[0]&&a.label<r[1]){a.label=r[1],r=c;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(c);break}r[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],o=0}finally{n=r=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,(function(e){switch(e.label){case 0:return[4,(new a).getAndInjectScript()];case 1:return e.sent(),[2]}}))},new((e=void 0)||(e=Promise))((function(n,o){function r(e){try{a(t.next(e))}catch(e){o(e)}}function i(e){try{a(t.throw(e))}catch(e){o(e)}}function a(t){var o;t.done?n(t.value):(o=t.value,o instanceof e?o:new e((function(e){e(o)}))).then(r,i)}a((t=t.apply(void 0,[])).next())}))})();